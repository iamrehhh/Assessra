<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A-Level Business | Exam Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --lime-primary: #32CD32;
            --lime-dark: #228B22;
            --lime-light: #F0FFF0;
            --glass-bg: rgba(255, 255, 255, 0.95);
            --text-dark: #1a1a1a;
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: linear-gradient(135deg, #f6fff6 0%, #e8f5e9 100%);
            color: var(--text-dark);
            min-height: 100vh;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        /* === LOGIN SCREEN === */
        .login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px);
            z-index: 1000;
        }
        .login-card {
            background: white; padding: 50px; width: 400px; border-radius: 24px;
            box-shadow: var(--shadow); text-align: center; border: 1px solid var(--lime-light);
        }
        .login-card h1 { color: var(--lime-dark); font-weight: 800; margin-bottom: 30px; }
        .login-input {
            width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px;
            border: 2px solid #eee; font-size: 1rem; transition: 0.3s;
        }
        .login-input:focus { border-color: var(--lime-primary); outline: none; }
        
        /* === NAVIGATION & HEADER === */
        .app-header {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--glass-bg); padding: 20px 30px; border-radius: 20px;
            margin-bottom: 30px; border: 1px solid white; box-shadow: var(--shadow);
        }
        .nav-btn {
            background: transparent; border: none; font-weight: 700; color: #666;
            padding: 10px 20px; cursor: pointer; transition: 0.3s; font-size: 1rem;
        }
        .nav-btn.active { color: var(--lime-dark); background: var(--lime-light); border-radius: 10px; }
        
        /* === PAPERS GRID === */
        .section-title { color: var(--lime-dark); margin: 30px 0 15px 0; font-size: 1.5rem; font-weight: 800; }
        .papers-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .paper-card {
            background: white; padding: 25px; border-radius: 18px; cursor: pointer;
            transition: 0.3s; border: 2px solid transparent; box-shadow: 0 4px 15px rgba(0,0,0,0.03);
        }
        .paper-card:hover { border-color: var(--lime-primary); transform: translateY(-5px); }
        .paper-tag { 
            display: inline-block; padding: 5px 10px; background: var(--lime-light); 
            color: var(--lime-dark); border-radius: 8px; font-size: 0.8rem; font-weight: 700; margin-bottom: 10px;
        }

        /* === SPLIT VIEW LAYOUT === */
        .workspace { display: grid; grid-template-columns: 1fr 1.2fr; gap: 30px; height: 85vh; }
        .insert-panel {
            background: white; border-radius: 20px; padding: 30px; overflow-y: auto;
            border: 1px solid #eee; box-shadow: var(--shadow); height: 100%;
        }
        .insert-content { white-space: pre-wrap; line-height: 1.8; color: #444; font-size: 1.05rem; }
        
        .questions-panel {
            overflow-y: auto; padding-right: 10px; height: 100%;
        }

        /* === QUESTION CARD === */
        .question-card {
            background: white; padding: 30px; border-radius: 20px; margin-bottom: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.02); border: 1px solid #f0f0f0;
        }
        .q-header { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .q-badge { background: var(--lime-dark); color: white; padding: 5px 12px; border-radius: 20px; font-weight: 700; font-size: 0.9rem; }
        .word-limit { font-size: 0.85rem; color: #888; margin-top: 5px; }
        
        textarea {
            width: 100%; min-height: 200px; padding: 15px; border: 2px solid #eee;
            border-radius: 12px; margin: 15px 0; font-family: inherit; font-size: 1rem;
            resize: vertical; transition: 0.3s;
        }
        textarea:focus { border-color: var(--lime-primary); outline: none; }

        /* === BUTTONS === */
        .submit-btn {
            background: linear-gradient(135deg, var(--lime-primary) 0%, var(--lime-dark) 100%);
            color: white; border: none; padding: 12px 30px; border-radius: 50px;
            font-weight: 700; cursor: pointer; transition: 0.3s; width: 100%;
            box-shadow: 0 4px 15px rgba(50, 205, 50, 0.3); font-size: 1rem;
        }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(50, 205, 50, 0.4); }
        .submit-btn:disabled { background: #ccc; transform: none; box-shadow: none; }
        .submit-btn.completed { background: #333; }
        .sys-reset { background: none; border: none; color: #999; text-decoration: underline; margin-top: 15px; cursor: pointer; font-size: 0.8rem; }

        /* === FEEDBACK === */
        .feedback-box { margin-top: 20px; background: var(--lime-light); padding: 20px; border-radius: 16px; }
        .model-answer { background: #222; color: #eee; padding: 20px; border-radius: 12px; margin-top: 15px; line-height: 1.6; }

        /* === SCORECARD === */
        .score-table { width: 100%; border-collapse: collapse; background: white; border-radius: 15px; overflow: hidden; }
        .score-table th, .score-table td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        .score-table th { background: var(--lime-light); color: var(--lime-dark); }
        .reset-btn { background: #ff4757; color: white; border:none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: 700; }

        .hidden { display: none !important; }
        
        .toggle-insert { display: none; margin-bottom: 15px; background: #eee; padding: 10px; text-align: center; border-radius: 10px; cursor: pointer; }
        @media (max-width: 900px) {
            .workspace { grid-template-columns: 1fr; height: auto; }
            .insert-panel { display: none; height: 400px; }
            .insert-panel.show { display: block; }
            .toggle-insert { display: block; }
        }
    </style>
</head>
<body>

    <div id="login-layer" class="login-screen">
        <div class="login-card">
            <h1>EXAM PORTAL</h1>
            <input type="text" id="u-in" class="login-input" placeholder="name.surname">
            <input type="password" id="p-in" class="login-input" placeholder="Passcode (011406)">
            <button class="submit-btn" onclick="tryLogin()">ACCESS SYSTEM</button>
            <button class="sys-reset" onclick="resetAll()">Reset System Data</button>
        </div>
    </div>

    <div id="app-layer" class="hidden">
        <div class="container">
            <div class="app-header">
                <h2 style="color:var(--lime-dark)">Business Practice</h2>
                <div class="nav">
                    <button class="nav-btn active" onclick="setView('papers')">Papers</button>
                    <button class="nav-btn" onclick="setView('scorecard')">Scorecard</button>
                    <button class="nav-btn" onclick="doLogout()">Logout</button>
                </div>
            </div>

            <div id="view-papers">
                <div class="section-title">üìÖ Oct/Nov 2025 Series</div>
                <div class="papers-grid">
                    <div class="paper-card" onclick="openPaper('2025_on_31')">
                        <span class="paper-tag">9609/31</span>
                        <h3>Pedro's Perfect Pies (PPP)</h3>
                        <p style="color:#888; margin-top:5px;">8 Questions ‚Ä¢ Paper 3</p>
                    </div>
                    <div class="paper-card" onclick="openPaper('2025_on_32')">
                        <span class="paper-tag">9609/32</span>
                        <h3>Komate Tropical Juice (KTJ)</h3>
                        <p style="color:#888; margin-top:5px;">8 Questions ‚Ä¢ Paper 3</p>
                    </div>
                    <div class="paper-card" onclick="openPaper('2025_on_33')">
                        <span class="paper-tag">9609/33</span>
                        <h3>Lithium Battery Metals (LBM)</h3>
                        <p style="color:#888; margin-top:5px;">9 Questions ‚Ä¢ Paper 3</p>
                    </div>
                </div>

                <div class="section-title">üìÖ Feb/March 2025 Series</div>
                <div class="papers-grid">
                    <div class="paper-card" onclick="openPaper('2025_fm_32')">
                        <span class="paper-tag">9609/32</span>
                        <h3>Iyipada (IPA)</h3>
                        <p style="color:#888; margin-top:5px;">9 Questions ‚Ä¢ Paper 3</p>
                    </div>
                </div>
            </div>

            <div id="view-scorecard" class="hidden">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h2>Your Performance</h2>
                    <button class="reset-btn" onclick="resetAll()">‚ö† RESET ALL DATA</button>
                </div>
                <div id="score-table-container"></div>
            </div>

            <div id="view-workspace" class="hidden">
                <button class="nav-btn" onclick="backToDash()" style="margin-bottom:10px;">‚Üê Back to Papers</button>
                <div class="toggle-insert" onclick="toggleInsert()">üìñ Toggle Case Study</div>
                <div class="workspace">
                    <div class="insert-panel" id="insert-panel">
                        <h3 style="color:var(--lime-dark); margin-bottom:15px; position:sticky; top:0; background:white; padding:10px 0;">üìÑ Case Study Insert</h3>
                        <div id="insert-content" class="insert-content"></div>
                    </div>
                    <div class="questions-panel" id="questions-container"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const paperData = {
            '2025_on_31': {
                title: "Pedro's Perfect Pies (PPP)",
                insert: `Pedro's Perfect Pies (PPP)\n\nPedro left school without any formal qualifications... [Content Truncated for Safety]`,
                questions: [
                    { n: '1', m: 8, t: 'Analyse two likely impacts on PPP of the changing external influences.', l: '150-225' },
                    { n: '2', m: 8, t: 'Analyse two benefits to PPP of using quality assurance.', l: '150-225' },
                    { n: '3(a)', m: 2, t: 'Using Table 1.3, calculate the payback period for PPP\'s new machine.' },
                    { n: '3(b)', m: 2, t: 'Using Table 1.3, calculate the ARR for PPP\'s new machine.' },
                    { n: '3(c)', m: 12, t: 'Evaluate whether PPP should invest in the new machine.', l: '250-350' },
                    { n: '4(a)', m: 4, t: 'Calculate the monthly revenue from the sales of the classic pie after the price increase.' },
                    { n: '4(b)', m: 12, t: 'Evaluate the usefulness to PPP of elasticity measures.', l: '250-350' },
                    { n: '5', m: 12, t: 'Evaluate the importance of emotional intelligence to Pedro\'s leadership.', l: '250-350' }
                ]
            },
            '2025_on_32': {
                title: "Komate Tropical Juice (KTJ)",
                insert: `Komate Tropical Juice (KTJ)\n\nKTJ is a private limited company based in country B in Africa...`,
                questions: [
                    { n: '1', m: 8, t: 'Analyse one advantage and one disadvantage to KTJ of delegation.', l: '150-225' },
                    { n: '2', m: 8, t: 'Analyse two impacts on KTJ of its commitment to CSR.', l: '150-225' },
                    { n: '3(a)', m: 2, t: 'Calculate the payback period of the country C location.' },
                    { n: '3(b)', m: 2, t: 'Calculate the ARR of the country D location.' },
                    { n: '3(c)', m: 12, t: 'Evaluate which location KTJ should choose for its new factory.', l: '250-350' },
                    { n: '4(a)', m: 4, t: 'Calculate the four period centred moving average for Quarter 1 2025.' },
                    { n: '4(b)', m: 12, t: 'Evaluate the usefulness of time series analysis to KTJ.', l: '250-350' },
                    { n: '5', m: 12, t: 'Evaluate the likely impact on KTJ of fluctuations in the exchange rate.', l: '250-350' }
                ]
            },
            '2025_on_33': {
                title: "Lithium Battery Metals (LBM)",
                insert: `Lithium Battery Metals (LBM)\n\nLithium is an essential raw material...`,
                questions: [
                    { n: '1', m: 8, t: 'Analyse two advantages to the government of country G from nationalisation.', l: '150-225' },
                    { n: '2', m: 8, t: 'Analyse one benefit and one limitation of sales forecasting to LBM.', l: '150-225' },
                    { n: '3(a)', m: 2, t: 'Using Table 1.1, calculate the payback period.' },
                    { n: '3(b)', m: 2, t: 'Using Table 1.1, calculate the NPV over six years discounted at 8%.' },
                    { n: '3(c)', m: 12, t: 'Evaluate LBM\'s decision to go ahead with the hot water mine.', l: '250-350' },
                    { n: '4(a)', m: 4, t: 'Calculate total float for activity C and minimum project duration.' },
                    { n: '4(b)', m: 12, t: 'Evaluate the importance of CPA to the success of the hard rock mine.', l: '250-350' },
                    { n: '5', m: 12, t: 'Evaluate LBM\'s decision to use two different approaches to HRM.', l: '250-350' }
                ]
            },
            '2025_fm_32': {
                title: "Iyipada (IPA)",
                insert: `Iyipada (IPA)\n\nIPA is a private limited company in country N...`,
                questions: [
                    { n: '1', m: 8, t: 'Analyse one advantage and one disadvantage to IPA of changing employment contracts.', l: '150-225' },
                    { n: '2', m: 8, t: 'Analyse two methods to improve IPA\'s liquidity.', l: '150-225' },
                    { n: '3(a)', m: 2, t: 'Calculate, for 2024, IPA\'s market share.' },
                    { n: '3(b)', m: 2, t: 'Calculate, for 2025, the expected percentage market growth.' },
                    { n: '3(c)', m: 12, t: 'Evaluate the Marketing Director\'s proposed changes to IPA\'s marketing mix.', l: '250-350' },
                    { n: '4(a)', m: 2, t: 'Complete nodes 5 and 6 on the network diagram.' },
                    { n: '4(b)', m: 2, t: 'Calculate the total float for Activity F.' },
                    { n: '4(c)', m: 12, t: 'Evaluate the benefit to IPA of Critical Path Analysis (CPA).', l: '250-350' },
                    { n: '5', m: 12, t: 'Evaluate the most likely impact on IPA of the fiscal and monetary policy changes.', l: '250-350' }
                ]
            }
        };

        function getUser() { return localStorage.getItem('user'); }
        function setUser(u) { localStorage.setItem('user', u); }
        function getAttempts(u) { return JSON.parse(localStorage.getItem(`attempts_${u}`) || '{}'); }
        
        function saveAttempt(u, pid, qn, data) {
            const atts = getAttempts(u);
            if(!atts[pid]) atts[pid] = {};
            atts[pid][qn] = data;
            localStorage.setItem(`attempts_${u}`, JSON.stringify(atts));
        }

        function tryLogin() {
            const u = document.getElementById('u-in').value;
            const p = document.getElementById('p-in').value;
            if(p === '011406' && u.includes('.')) {
                setUser(u);
                document.getElementById('login-layer').classList.add('hidden');
                document.getElementById('app-layer').classList.remove('hidden');
                setView('papers');
            } else { alert("Incorrect Credentials."); }
        }

        function doLogout() {
            localStorage.removeItem('user'); location.reload();
        }

        function setView(viewName) {
            ['papers', 'scorecard', 'workspace'].forEach(v => document.getElementById(`view-${v}`).classList.add('hidden'));
            document.getElementById(`view-${viewName}`).classList.remove('hidden');
            if(viewName === 'scorecard') renderScorecard();
        }

        function backToDash() { setView('papers'); }
        function toggleInsert() { document.getElementById('insert-panel').classList.toggle('show'); }

        function openPaper(pid) {
            const data = paperData[pid];
            const u = getUser();
            const attempts = getAttempts(u)[pid] || {};
            document.getElementById('insert-content').innerText = data.insert;
            let qHtml = `<h2 style="margin-bottom:20px; color:var(--lime-dark);">${data.title}</h2>`;
            data.questions.forEach(q => {
                const att = attempts[q.n] || {};
                const done = att.score !== undefined;
                qHtml += `<div class="question-card">
                    <div class="q-header"><strong>Q${q.n}</strong><span class="q-badge">${q.m} Marks</span></div>
                    <p style="font-weight:600; margin-bottom:10px;">${q.t}</p>
                    ${q.l ? `<p class="word-limit">Limit: ${q.l} words</p>` : ''}
                    <textarea id="ans_${pid}_${q.n}">${att.answer || ''}</textarea>
                    <button class="submit-btn ${done ? 'completed' : ''}" onclick="submitAnswer('${pid}', '${q.n}')">${done ? '‚úì Re-Evaluate' : 'Submit'}</button>
                    ${done ? `<div class="feedback-box"><h3>Score: ${att.score}/${q.m}</h3><p><strong>Strengths:</strong> ${att.strengths}</p><p><strong>Improvements:</strong> ${att.weaknesses}</p><div class="model-answer"><strong>Model Answer:</strong><br>${att.modelAnswer}</div></div>` : ''}
                </div>`;
            });
            document.getElementById('questions-container').innerHTML = qHtml;
            setView('workspace');
        }

        async function submitAnswer(pid, qn) {
            const el = document.getElementById(`ans_${pid}_${qn}`);
            const btn = event.target;
            const ans = el.value.trim();
            if(!ans) return alert("Please write an answer first.");
            btn.innerText = "‚è≥ Marking..."; btn.disabled = true;
            try {
                const res = await fetch('https://ultimate-exam-guide.onrender.com', {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ question: paperData[pid].questions.find(q=>q.n===qn).t, case_study: paperData[pid].insert, answer: ans, marks: paperData[pid].questions.find(q=>q.n===qn).m })
                });
                const json = await res.json();
                saveAttempt(getUser(), pid, qn, { answer: ans, score: json.score, strengths: json.strengths, weaknesses: json.weaknesses, modelAnswer: json.model_answer });
                openPaper(pid);
            } catch(e) { alert("Error: Is Terminal running?"); btn.innerText = "Retry"; btn.disabled = false; }
        }

        function renderScorecard() {
            const u = getUser();
            const allAtts = getAttempts(u);
            let html = `<table class="score-table"><thead><tr><th>Paper</th><th>Attempted</th><th>Score</th><th>Action</th></tr></thead><tbody>`;
            Object.keys(paperData).forEach(pid => {
                const pAtts = allAtts[pid] || {};
                let totalScore = 0, maxScore = 0;
                paperData[pid].questions.forEach(q => { maxScore += q.m; if(pAtts[q.n]) totalScore += (pAtts[q.n].score || 0); });
                html += `<tr><td><strong>${paperData[pid].title}</strong></td><td>${Object.keys(pAtts).length}/${paperData[pid].questions.length}</td><td><span style="color:var(--lime-dark);font-weight:800;">${totalScore}</span>/${maxScore}</td><td><button class="reset-btn" onclick="resetPaper('${pid}')">Reset</button></td></tr>`;
            });
            html += `</tbody></table>`;
            document.getElementById('score-table-container').innerHTML = html;
        }

        function resetPaper(pid) {
            if(confirm("Delete all answers for this paper?")) {
                const u = getUser();
                const atts = getAttempts(u);
                delete atts[pid];
                localStorage.setItem(`attempts_${u}`, JSON.stringify(atts));
                renderScorecard();
            }
        }
        function resetAll() {
            if(confirm("WIPE ALL DATA?")) { localStorage.clear(); location.reload(); }
        }
        if(getUser()) { document.getElementById('login-layer').classList.add('hidden'); document.getElementById('app-layer').classList.remove('hidden'); setView('papers'); }
    </script>
</body>
</html>