<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> A-Level Business | The One</title>
<link rel="icon" type="image/png" href="logo.png">
<link href="[https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap](https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap)" rel="stylesheet">
<style>
    /* GLOBAL FONT */
    @import url('[https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap](https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap)');
    /* NEW FONTS */
    @import url('[https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@600;700&display=swap](https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@600;700&display=swap)');

    :root {
        --lime-primary: #32CD32;
        --lime-dark: #228B22;
        --lime-light: #F0FFF0;
        --glass-bg: rgba(255, 255, 255, 0.95);
        --text-dark: #1a1a1a;
        --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
        font-family: 'Plus Jakarta Sans', sans-serif; 
        background: linear-gradient(135deg, #f6fff6 0%, #e8f5e9 100%);
        color: var(--text-dark);
        min-height: 100vh;
    }

    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

    /* === CHATBOT STYLES (NEW) === */
    #view-chat {
        height: 80vh;
        display: flex;
        flex-direction: column;
        background: white;
        border-radius: 20px;
        box-shadow: var(--shadow);
        border: 1px solid rgba(0,0,0,0.05);
        overflow: hidden;
    }

    .chat-header {
        padding: 20px;
        background: var(--lime-light);
        border-bottom: 1px solid rgba(0,0,0,0.05);
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .chat-window {
        flex: 1;
        overflow-y: auto;
        padding: 30px;
        display: flex;
        flex-direction: column;
        gap: 20px;
        background: #fafafa;
    }

    .chat-msg {
        max-width: 75%;
        padding: 15px 20px;
        border-radius: 18px;
        line-height: 1.6;
        font-size: 1rem;
        position: relative;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .user-msg {
        align-self: flex-end;
        background: var(--lime-dark);
        color: white;
        border-bottom-right-radius: 4px;
        box-shadow: 0 4px 15px rgba(34, 139, 34, 0.2);
    }

    .ai-msg {
        align-self: flex-start;
        background: white;
        color: #333;
        border: 1px solid #eee;
        border-bottom-left-radius: 4px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.03);
    }
    
    /* Make bold text in AI messages pop */
    .ai-msg strong { color: var(--lime-dark); font-weight: 700; }

    .chat-input-area {
        padding: 20px;
        background: white;
        border-top: 1px solid #eee;
        display: flex;
        gap: 15px;
        align-items: center;
    }

    #chat-input {
        flex: 1;
        padding: 15px;
        border: 2px solid #eee;
        border-radius: 50px;
        font-size: 1rem;
        font-family: inherit;
        outline: none;
        transition: 0.3s;
    }

    #chat-input:focus { border-color: var(--lime-primary); }

    .send-chat-btn {
        background: var(--lime-dark);
        color: white;
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.2rem;
        transition: 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .send-chat-btn:hover { transform: scale(1.1); background: var(--lime-primary); }


    /* === EXISTING STYLES === */
    #view-formulae .formula-section { margin-bottom: 40px; }
    #view-formulae .chapter-title { font-family: 'Playfair Display', serif; font-size: 1.6rem; color: #1a1a1a; margin-bottom: 20px; border-bottom: 2px solid var(--lime-primary); padding-bottom: 5px; display: inline-block; }
    #view-formulae .formula-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
    #view-formulae .formula-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.05); transition: transform 0.2s ease; position: relative; overflow: hidden; }
    #view-formulae .formula-card:hover { transform: translateY(-3px); border-color: var(--lime-primary); }
    #view-formulae .formula-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--lime-primary); }
    #view-formulae .f-title { font-family: 'Inter', sans-serif; font-size: 0.85rem; font-weight: 600; color: #888; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
    #view-formulae .f-body { font-family: 'Inter', sans-serif; font-size: 1.15rem; font-weight: 500; color: #2c3e50; line-height: 1.4; }

    .login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); z-index: 1000; }
    .login-card { background: white; padding: 50px; width: 400px; border-radius: 24px; box-shadow: var(--shadow); text-align: center; border: 1px solid var(--lime-light); }
    .login-card h1 { color: var(--lime-dark); font-weight: 800; margin-bottom: 30px; }
    .login-input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; border: 2px solid #eee; font-size: 1rem; transition: 0.3s; }
    .login-input:focus { border-color: var(--lime-primary); outline: none; }
    
    .app-header { display: flex; justify-content: space-between; align-items: center; background: var(--glass-bg); padding: 20px 30px; border-radius: 20px; margin-bottom: 30px; border: 1px solid white; box-shadow: var(--shadow); }
    .header-left { display: flex; align-items: center; }
    .app-logo { height: 45px; width: auto; margin-right: 15px; }
    .nav-btn { background: transparent; border: none; font-weight: 700; color: #666; padding: 10px 20px; cursor: pointer; transition: 0.3s; font-size: 1rem; }
    .nav-btn.active { color: var(--lime-dark); background: var(--lime-light); border-radius: 10px; }
    
    .series-header { margin: 40px 0 20px 0; border-bottom: 2px solid #eee; padding-bottom: 10px; display: flex; align-items: baseline; gap: 15px; }
    .year-big { font-size: 2rem; font-weight: 800; color: #ccc; }
    .series-name { font-size: 1.4rem; font-weight: 700; color: var(--lime-dark); }
    .papers-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
    .paper-card { background: white; padding: 25px; border-radius: 18px; cursor: pointer; transition: 0.3s; border: 2px solid transparent; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
    .paper-card:hover { border-color: var(--lime-primary); transform: translateY(-5px); }
    .paper-tag { display: inline-block; padding: 5px 10px; background: var(--lime-light); color: var(--lime-dark); border-radius: 8px; font-size: 0.8rem; font-weight: 700; margin-bottom: 10px; }
    
    .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: white; padding: 25px; border-radius: 20px; box-shadow: var(--shadow); border: 1px solid var(--lime-light); text-align: center; transition: transform 0.3s ease; }
    .stat-card:hover { transform: translateY(-5px); border-color: var(--lime-primary); }
    .stat-value { font-size: 2.5rem; font-weight: 800; color: var(--lime-dark); display: block; margin-bottom: 5px; }
    .stat-label { font-size: 0.9rem; color: #888; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
    .modern-table { width: 100%; border-collapse: separate; border-spacing: 0 15px; margin-top: 10px; }
    .modern-table thead th { color: #888; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; padding: 0 20px 10px 20px; border: none; background: transparent; text-align: left; }
    .modern-table tbody tr { background: white; box-shadow: 0 5px 20px rgba(0,0,0,0.03); }
    .modern-table td { padding: 20px; border: none; }
    .modern-table td:first-child { border-top-left-radius: 15px; border-bottom-left-radius: 15px; }
    .modern-table td:last-child { border-top-right-radius: 15px; border-bottom-right-radius: 15px; text-align: right; }
    .score-badge { background: var(--lime-light); color: var(--lime-dark); padding: 8px 16px; border-radius: 30px; font-weight: 800; font-size: 1rem; border: 1px solid var(--lime-primary); }
    .progress-track { background: #f0f0f0; height: 8px; width: 100px; border-radius: 10px; overflow: hidden; display: inline-block; vertical-align: middle; margin-right: 10px; }
    .progress-fill { background: var(--lime-primary); height: 100%; border-radius: 10px; }
    .reset-icon-btn { background: #fff0f0; color: #ff4757; border: 1px solid #ff4757; padding: 8px 15px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 0.8rem; transition: 0.3s; }
    .reset-icon-btn:hover { background: #ff4757; color: white; }

    .workspace { display: grid; grid-template-columns: 1fr 1.2fr; gap: 30px; height: 85vh; }
    .insert-panel { background: #333; border-radius: 20px; overflow: hidden; box-shadow: var(--shadow); height: 100%; position: relative; }
    .insert-pdf-frame { width: 100%; height: 100%; border: none; }
    .questions-panel { overflow-y: auto; padding-right: 10px; height: 100%; }
    .question-card { background: white; padding: 30px; border-radius: 20px; margin-bottom: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.02); border: 1px solid #f0f0f0; }
    .q-header { display: flex; justify-content: space-between; margin-bottom: 15px; }
    .q-badge { background: var(--lime-dark); color: white; padding: 5px 12px; border-radius: 20px; font-weight: 700; font-size: 0.9rem; }
    textarea { width: 100%; min-height: 200px; padding: 15px; border: 2px solid #eee; border-radius: 12px; margin: 15px 0; font-family: inherit; font-size: 1rem; resize: vertical; transition: 0.3s; }
    textarea:focus { border-color: var(--lime-primary); outline: none; }
    .submit-btn { background: linear-gradient(135deg, var(--lime-primary) 0%, var(--lime-dark) 100%); color: white; border: none; padding: 12px 30px; border-radius: 50px; font-weight: 700; cursor: pointer; transition: 0.3s; width: 100%; box-shadow: 0 4px 15px rgba(50, 205, 50, 0.3); font-size: 1rem; }
    .submit-btn:disabled { background: #ccc; transform: none; box-shadow: none; }
    .feedback-box { margin-top: 25px; background: #f8fff8; padding: 25px; border-radius: 16px; border: 1px solid var(--lime-primary); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .feedback-box h3 { margin-top: 0; color: var(--lime-dark); font-size: 1.4rem; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
    .feedback-box p { line-height: 1.8; color: #444; margin-bottom: 15px; font-size: 0.95rem; white-space: pre-wrap; }
    .feedback-box strong { color: #1a1a1a; font-weight: 700; display: block; margin-bottom: 5px; font-size: 1rem; }
    .model-answer-box { white-space: pre-wrap; line-height: 1.7; font-family: 'Inter', sans-serif; background: #1e1e1e; color: #e0e0e0; padding: 25px; border-radius: 12px; margin-top: 20px; font-size: 0.95rem; border-left: 4px solid var(--lime-primary); }

    .hidden { display: none !important; }
    .toggle-insert { display: none; margin-bottom: 15px; background: #eee; padding: 10px; text-align: center; border-radius: 10px; cursor: pointer; }
    @media (max-width: 900px) { .workspace { grid-template-columns: 1fr; height: auto; } .insert-panel { display: none; height: 400px; } .insert-panel.show { display: block; } .toggle-insert { display: block; } }

    #view-definitions .def-section { margin-bottom: 50px; }
    #view-definitions .topic-title { font-family: 'Playfair Display', serif; font-size: 1.8rem; color: #1a1a1a; margin-bottom: 25px; border-bottom: 2px solid var(--lime-primary); padding-bottom: 8px; display: inline-block; }
    #view-definitions .def-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
    #view-definitions .def-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.05); transition: transform 0.2s ease; position: relative; overflow: hidden; }
    #view-definitions .def-card:hover { transform: translateY(-3px); border-color: var(--lime-primary); box-shadow: 0 10px 25px rgba(50, 205, 50, 0.15); }
    #view-definitions .def-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: #3b82f6; }
    #view-definitions .d-term { font-family: 'Playfair Display', serif; font-size: 1.1rem; font-weight: 700; color: #1e293b; margin-bottom: 10px; }
    #view-definitions .d-desc { font-family: 'Inter', sans-serif; font-size: 0.95rem; font-weight: 400; color: #475569; line-height: 1.6; }
    .word-count-display { font-size: 0.85rem; color: #666; font-weight: 600; background: #f5f5f5; padding: 4px 10px; border-radius: 20px; }

</style>
</head>
<body>

<div id="login-layer" class="login-screen">
    <div class="login-card" style="text-align: left;">
<img src="logo.png" alt="Logo" style="width: 100%; height: auto; display: block; margin-bottom: 20px;">    
<input type="text" id="u-in" class="login-input" placeholder="username">
    <input type="password" id="p-in" class="login-input" placeholder="******">
    <button class="submit-btn" onclick="tryLogin()">Sign in</button>
</div>
</div>

<div id="app-layer" class="hidden">
    <div class="container">
        
        <div class="app-header">
            <div class="header-left">
                <img src="logo.png" alt="Logo" class="app-logo" onerror="this.style.display='none'"> 
                <div>
                    <h2 style="color:var(--lime-dark); margin:0;">Business Practice</h2>
                    <div id="welcome-msg" class="welcome-text"></div>
                </div>
            </div>
           <div class="nav">
    <button class="nav-btn active" onclick="setView('papers')">Papers</button>
    <button class="nav-btn" onclick="setView('formulae')">Formulae</button>
    <button class="nav-btn" onclick="setView('definitions')">Definitions</button>
    <button class="nav-btn" onclick="setView('scorecard')">Scorecard</button>
    <button class="nav-btn" onclick="setView('chat')">AI Tutor</button>
    <button class="nav-btn" onclick="doLogout()">Logout</button>
</div>
        </div>

        <div id="view-chat" class="hidden">
            <div class="chat-header">
                <div style="font-size:1.5rem;">ü§ñ</div>
                <div>
                    <h3 style="margin:0; color:var(--text-dark);">Study Assistant</h3>
                    <p style="margin:0; color:#888; font-size:0.9rem;">Ask me anything about Business or Economics</p>
                </div>
            </div>
            <div class="chat-window" id="chat-messages">
                <div class="chat-msg ai-msg">Hello! I'm your AI Tutor. I can help you understand concepts, formulas, or marking schemes for Business (9609). What are you studying today?</div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chat-input" placeholder="Type your question here (e.g. 'Explain Price Elasticity')..." onkeypress="handleChatEnter(event)">
                <button class="send-chat-btn" onclick="sendChatMessage()">‚û§</button>
            </div>
        </div>

        <div id="view-papers">
            <div class="series-header"><div class="year-big">2024</div><div class="series-name">Feb / March Series</div></div>
            <div class="papers-grid">
                <div class="paper-card" onclick="openPaper('2024_fm_32')"><span class="paper-tag">9609/32</span><h3>Clean Delivery (CD)</h3><p style="color:#888; margin-top:5px;">Paper 3 ‚Ä¢ PDF Available</p></div>
            </div>
            
            <div class="series-header"><div class="year-big">2024</div><div class="series-name">May / June Series</div></div>
            <div class="papers-grid">
                <div class="paper-card" onclick="openPaper('2024_mj_31')"><span class="paper-tag">9609/31</span><h3>Gordy Building Supplies (GBS)</h3><p style="color:#888; margin-top:5px;">Paper 3 ‚Ä¢ PDF Available</p></div>
                <div class="paper-card" onclick="openPaper('2024_mj_32')"><span class="paper-tag">9609/32</span><h3>Soymai Farms (SF)</h3><p style="color:#888; margin-top:5px;">Paper 3 ‚Ä¢ PDF Available</p></div>
                <div class="paper-card" onclick="openPaper('2024_mj_33')"><span class="paper-tag">9609/33</span><h3>Sunil's Clothing Company (SCC)</h3><p style="color:#888; margin-top:5px;">Paper 3 ‚Ä¢ PDF Available</p></div>
            </div>

            <div class="series-header"><div class="year-big">2024</div><div class="series-name">Oct / Nov Series</div></div>
            <div class="papers-grid">
                <div class="paper-card" onclick="openPaper('2024_on_31')"><span class="paper-tag">9609/31</span><h3>TopoChoc Enterprises (TC)</h3><p style="color:#888; margin-top:5px;">Paper 3 ‚Ä¢ PDF Available</p></div>
                <div class="paper-card" onclick="openPaper('2024_on_32')"><span class="paper-tag">9609/32</span><h3>Habesha Clean Cooking (HCC)</h3><p style="color:#888; margin-top:5px;">Paper 3 ‚Ä¢ PDF Available</p></div>
                <div class="paper-card" onclick="openPaper('2024_on_33')"><span class="paper-tag">9609/33</span><h3>Australasia Fitness Factory (AFF)</h3><p style="color:#888; margin-top:5px;">Paper 3 ‚Ä¢ PDF Available</p></div>
            </div>

            <div class="series-header"><div class="year-big">2025</div><div class="series-name">Feb / March Series</div></div>
            <div class="papers-grid">
                <div class="paper-card" onclick="openPaper('2025_fm_32')"><span class="paper-tag">9609/32</span><h3>Iyipada (IPA)</h3><p style="color:#888; margin-top:5px;">Paper 3 ‚Ä¢ PDF Available</p></div>
            </div>

            <div class="series-header"><div class="year-big">2025</div><div class="series-name">May / June Series</div></div>
            <div class="papers-grid">
                <div class="paper-card" onclick="openPaper('2025_mj_31')"><span class="paper-tag">9609/31</span><h3>Wisdom Shoes (WS)</h3><p style="color:#888; margin-top:5px;">Paper 3 ‚Ä¢ PDF Available</p></div>
                <div class="paper-card" onclick="openPaper('2025_mj_32')"><span class="paper-tag">9609/32</span><h3>Pura AI Robots (PAIR)</h3><p style="color:#888; margin-top:5px;">Paper 3 ‚Ä¢ PDF Available</p></div>
                <div class="paper-card" onclick="openPaper('2025_mj_33')"><span class="paper-tag">9609/33</span><h3>We Care Products (WCP)</h3><p style="color:#888; margin-top:5px;">Paper 3 ‚Ä¢ PDF Available</p></div>
            </div>

            <div class="series-header"><div class="year-big">2025</div><div class="series-name">Oct / Nov Series</div></div>
            <div class="papers-grid">
                <div class="paper-card" onclick="openPaper('2025_on_31')"><span class="paper-tag">9609/31</span><h3>Pedro's Perfect Pies (PPP)</h3><p style="color:#888; margin-top:5px;">Paper 3 ‚Ä¢ PDF Available</p></div>
                <div class="paper-card" onclick="openPaper('2025_on_32')"><span class="paper-tag">9609/32</span><h3>Komate Tropical Juice (KTJ)</h3><p style="color:#888; margin-top:5px;">Paper 3 ‚Ä¢ PDF Available</p></div>
                <div class="paper-card" onclick="openPaper('2025_on_33')"><span class="paper-tag">9609/33</span><h3>Lithium Battery Metals (LBM)</h3><p style="color:#888; margin-top:5px;">Paper 3 ‚Ä¢ PDF Available</p></div>
            </div>
        
        </div> <div id="view-formulae" class="hidden">
            <div class="formula-section">
                <h3 class="chapter-title">Finance: Ratio Analysis</h3>
                <div class="formula-grid">
                    <div class="formula-card"><div class="f-title">Current Ratio</div><div class="f-body">Current Assets / Current Liabilities</div></div>
                    <div class="formula-card"><div class="f-title">Acid Test Ratio</div><div class="f-body">Liquid Assets / Current Liabilities</div></div>
                    <div class="formula-card"><div class="f-title">ROCE</div><div class="f-body">(Operating Profit / Capital Employed) √ó 100</div></div>
                    <div class="formula-card"><div class="f-title">Gearing Ratio</div><div class="f-body">(Non-Current Liabilities / Capital Employed) √ó 100</div></div>
                    <div class="formula-card"><div class="f-title">Gross Profit Margin</div><div class="f-body">(Gross Profit / Revenue) √ó 100</div></div>
                    <div class="formula-card"><div class="f-title">Operating Profit Margin</div><div class="f-body">(Operating Profit / Revenue) √ó 100</div></div>
                    <div class="formula-card"><div class="f-title">Inventory Turnover</div><div class="f-body">Cost of Sales / Average Inventory</div></div>
                    <div class="formula-card"><div class="f-title">Trade Payables Turnover</div><div class="f-body">(Trade Payables / Credit Purchases) √ó 365</div></div>
                </div>
            </div>
            <div class="formula-section">
                <h3 class="chapter-title">Finance: Shareholder Ratios</h3>
                <div class="formula-grid">
                    <div class="formula-card"><div class="f-title">Earnings Per Share (EPS)</div><div class="f-body">Profit for Year / Number of Issued Shares</div></div>
                    <div class="formula-card"><div class="f-title">Price / Earnings (P/E) Ratio</div><div class="f-body">Market Price / Earnings Per Share</div></div>
                    <div class="formula-card"><div class="f-title">Dividend Per Share</div><div class="f-body">Total Annual Dividends / Total Issued Shares</div></div>
                    <div class="formula-card"><div class="f-title">Dividend Yield</div><div class="f-body">(Dividend Per Share / Market Price) √ó 100</div></div>
                    <div class="formula-card"><div class="f-title">Dividend Cover</div><div class="f-body">Profit for Year / Annual Dividends</div></div>
                </div>
            </div>
            <div class="formula-section">
                <h3 class="chapter-title">Investment Appraisal</h3>
                <div class="formula-grid">
                    <div class="formula-card"><div class="f-title">ARR (Accounting Rate of Return)</div><div class="f-body">(Average Annual Profit / Average Investment) √ó 100</div></div>
                    <div class="formula-card"><div class="f-title">Payback Period</div><div class="f-body">Amount Invested / Annual Net Cash Flow</div></div>
                    <div class="formula-card"><div class="f-title">Payback (Monthly Adj.)</div><div class="f-body">(Additional Cash Needed / Annual Cash Flow) √ó 12</div></div>
                    <div class="formula-card"><div class="f-title">Average Investment</div><div class="f-body">(Initial Cost + Residual Value) / 2</div></div>
                </div>
            </div>
            <div class="formula-section">
                <h3 class="chapter-title">Marketing</h3>
                <div class="formula-grid">
                    <div class="formula-card"><div class="f-title">Market Share</div><div class="f-body">(Sales of Business / Total Market Sales) √ó 100</div></div>
                    <div class="formula-card"><div class="f-title">Price Elasticity (PED)</div><div class="f-body">% Change in Demand / % Change in Price</div></div>
                    <div class="formula-card"><div class="f-title">Income Elasticity (YED)</div><div class="f-body">% Change in Demand / % Change in Income</div></div>
                    <div class="formula-card"><div class="f-title">Promotional Elasticity</div><div class="f-body">% Change in Demand / % Change in Spending</div></div>
                </div>
            </div>
            <div class="formula-section">
                <h3 class="chapter-title">Operations & Project Management</h3>
                <div class="formula-grid">
                    <div class="formula-card"><div class="f-title">Capacity Utilisation</div><div class="f-body">(Current Output / Maximum Output) √ó 100</div></div>
                    <div class="formula-card"><div class="f-title">Total Float</div><div class="f-body">LFT - Duration - EST</div></div>
                    <div class="formula-card"><div class="f-title">Free Float</div><div class="f-body">EST (Next Activity) - Duration - EST (This Activity)</div></div>
                </div>
            </div>
            <div class="formula-section">
                <h3 class="chapter-title">Human Resources</h3>
                <div class="formula-grid">
                    <div class="formula-card"><div class="f-title">Absenteeism Rate</div><div class="f-body">(Total Days Absent / Total Work Days) √ó 100</div></div>
                    <div class="formula-card"><div class="f-title">Labour Turnover</div><div class="f-body">(Number of Staff Leaving / Average Staff) √ó 100</div></div>
                </div>
            </div>
        </div>
        
<div id="view-definitions" class="hidden">
    
    <div class="def-section">
        <h3 class="topic-title">Strategy & Economics</h3>
        <div class="def-grid">
            <div class="def-card"><div class="d-term">Privatization</div><div class="d-desc">The act of selling state-owned and controlled business organizations to investors in the private sector.</div></div>
            <div class="def-card"><div class="d-term">Nationalization</div><div class="d-desc">The transfer of privately owned businesses to state (government) ownership and control.</div></div>
            <div class="def-card"><div class="d-term">Globalization</div><div class="d-desc">The increasing freedom of movement of goods, capital, and people around the world.</div></div>
            <div class="def-card"><div class="d-term">Protectionism</div><div class="d-desc">The use of barriers to free trade (like tariffs/quotas) to protect a country's domestic industries.</div></div>
            <div class="def-card"><div class="d-term">Tariff</div><div class="d-desc">A tax imposed on an imported product.</div></div>
            <div class="def-card"><div class="d-term">Quota</div><div class="d-desc">A physical limit placed on the quantity of imports of certain products.</div></div>
            <div class="def-card"><div class="d-term">GDP (Gross Domestic Product)</div><div class="d-desc">The total value of goods and services produced in a country in one year.</div></div>
            <div class="def-card"><div class="d-term">Inflation</div><div class="d-desc">An increase in the average price level of goods and services, resulting in a fall in the value of money.</div></div>
            <div class="def-card"><div class="d-term">Recession</div><div class="d-desc">A decline in real GDP over two or more consecutive quarters (at least six months).</div></div>
            <div class="def-card"><div class="d-term">Monetary Policy</div><div class="d-desc">Decisions about interest rates and the money supply in the economy.</div></div>
            <div class="def-card"><div class="d-term">Fiscal Policy</div><div class="d-desc">Decisions about government expenditure, tax rates, and borrowing.</div></div>
            <div class="def-card"><div class="d-term">SWOT Analysis</div><div class="d-desc">Strategic analysis identifying internal Strengths and Weaknesses, and external Opportunities and Threats.</div></div>
            <div class="def-card"><div class="d-term">PEST Analysis</div><div class="d-desc">Strategic analysis of a firm‚Äôs macro environment: Political, Economic, Social, and Technological factors.</div></div>
            <div class="def-card"><div class="d-term">Porter‚Äôs Five Forces</div><div class="d-desc">Technique for analysing competitive forces within an industry (e.g., supplier power, buyer power).</div></div>
            <div class="def-card"><div class="d-term">Ansoff Matrix</div><div class="d-desc">Model showing risk in growth strategies: market penetration, product development, market development, and diversification.</div></div>
            <div class="def-card"><div class="d-term">Core Competence</div><div class="d-desc">An essential business capability that provides a competitive advantage.</div></div>
            <div class="def-card"><div class="d-term">Blue Ocean Strategy</div><div class="d-desc">Exploiting uncontested market space through product differentiation and low cost.</div></div>
            <div class="def-card"><div class="d-term">Corporate Culture</div><div class="d-desc">The values, attitudes, and beliefs of an organisation‚Äôs people that influence interactions.</div></div>
        </div>
    </div>

    <div class="def-section">
        <h3 class="topic-title">Finance & Accounting</h3>
        <div class="def-grid">
            <div class="def-card"><div class="d-term">Asset</div><div class="d-desc">An item of monetary value owned by a business.</div></div>
            <div class="def-card"><div class="d-term">Liability</div><div class="d-desc">A financial obligation that a business must pay in the future.</div></div>
            <div class="def-card"><div class="d-term">Working Capital</div><div class="d-desc">Capital for day-to-day activities (Current Assets - Current Liabilities).</div></div>
            <div class="def-card"><div class="d-term">Capital Employed</div><div class="d-desc">The total value of long-term finance invested in a business.</div></div>
            <div class="def-card"><div class="d-term">Depreciation</div><div class="d-desc">The reduction in the estimated value of a non-current asset over time.</div></div>
            <div class="def-card"><div class="d-term">Liquidity Ratios</div><div class="d-desc">Current Ratio (Assets/Liabilities) and Acid Test (Liquid Assets/Liabilities).</div></div>
            <div class="def-card"><div class="d-term">ROCE</div><div class="d-desc">Return on Capital Employed: (Operating Profit / Capital Employed) √ó 100.</div></div>
            <div class="def-card"><div class="d-term">Gearing Ratio</div><div class="d-desc">Measures the proportion of capital employed financed by long-term borrowing.</div></div>
            <div class="def-card"><div class="d-term">Window Dressing</div><div class="d-desc">Techniques to manipulate financial statements to show more favorable results.</div></div>
            <div class="def-card"><div class="d-term">Investment Appraisal</div><div class="d-desc">Evaluating the profitability of an investment (NPV, ARR, Payback).</div></div>
            <div class="def-card"><div class="d-term">Net Present Value (NPV)</div><div class="d-desc">The current value of estimated future cash flows resulting from an investment.</div></div>
            <div class="def-card"><div class="d-term">Payback Period</div><div class="d-desc">Time taken for net cash inflows to recover the original capital cost.</div></div>
            <div class="def-card"><div class="d-term">Dividend Yield</div><div class="d-desc">Annual return from dividends as a percentage of the current market share price.</div></div>
            <div class="def-card"><div class="d-term">P/E Ratio</div><div class="d-desc">Price/Earnings: Number of years to earn back the share price at current earnings.</div></div>
        </div>
    </div>

    <div class="def-section">
        <h3 class="topic-title">Human Resources</h3>
        <div class="def-grid">
            <div class="def-card"><div class="d-term">Hard HRM</div><div class="d-desc">Approach to managing employees focused on cutting costs and strict control.</div></div>
            <div class="def-card"><div class="d-term">Soft HRM</div><div class="d-desc">Approach focused on employee development, motivation, and self-fulfillment.</div></div>
            <div class="def-card"><div class="d-term">Emotional Intelligence</div><div class="d-desc">Ability to understand and manage one's own emotions and those of others.</div></div>
            <div class="def-card"><div class="d-term">Transformational Leadership</div><div class="d-desc">Leaders who create a vision and inspire teams to implement change collaboratively.</div></div>
            <div class="def-card"><div class="d-term">Delegation</div><div class="d-desc">Passing authority down the organisational hierarchy.</div></div>
            <div class="def-card"><div class="d-term">Span of Control</div><div class="d-desc">The number of subordinates directly accountable to a manager.</div></div>
            <div class="def-card"><div class="d-term">Delayering</div><div class="d-desc">Removing one or more levels of hierarchy from the organisational structure.</div></div>
            <div class="def-card"><div class="d-term">Gig Economy</div><div class="d-desc">Labor market with temporary, flexible jobs, often using independent contractors.</div></div>
            <div class="def-card"><div class="d-term">Zero-hours Contract</div><div class="d-desc">Contract with no guaranteed minimum hours, requiring availability when called.</div></div>
            <div class="def-card"><div class="d-term">Absenteeism</div><div class="d-desc">The rate of workforce absence as a proportion of total employees.</div></div>
        </div>
    </div>

    <div class="def-section">
        <h3 class="topic-title">Marketing</h3>
        <div class="def-grid">
            <div class="def-card"><div class="d-term">Price Elasticity (PED)</div><div class="d-desc">Measure of how demand changes in response to a change in price.</div></div>
            <div class="def-card"><div class="d-term">Income Elasticity (YED)</div><div class="d-desc">Measure of how demand changes in response to changes in consumer income.</div></div>
            <div class="def-card"><div class="d-term">Sales Forecasting</div><div class="d-desc">Predicting future sales using trends (Moving Averages) or qualitative methods (Delphi).</div></div>
            <div class="def-card"><div class="d-term">International Marketing</div><div class="d-desc">Selling products in markets outside the original domestic market.</div></div>
            <div class="def-card"><div class="d-term">Global Localisation</div><div class="d-desc">Adjusting the marketing mix to suit local tastes while maintaining global strategy (Glocalization).</div></div>
            <div class="def-card"><div class="d-term">Pan-global Marketing</div><div class="d-desc">Marketing a standardised product worldwide as if the world were a single market.</div></div>
            <div class="def-card"><div class="d-term">Product Development</div><div class="d-desc">Developing and selling new or improved products in existing markets.</div></div>
        </div>
    </div>

    <div class="def-section">
        <h3 class="topic-title">Operations Management</h3>
        <div class="def-grid">
            <div class="def-card"><div class="d-term">TQM (Total Quality Management)</div><div class="d-desc">Quality approach involving all employees in continuous improvement.</div></div>
            <div class="def-card"><div class="d-term">Kaizen</div><div class="d-desc">Japanese term meaning continuous improvement.</div></div>
            <div class="def-card"><div class="d-term">Lean Production</div><div class="d-desc">Producing goods with minimal waste while maintaining high quality.</div></div>
            <div class="def-card"><div class="d-term">Critical Path Analysis (CPA)</div><div class="d-desc">Planning technique identifying the sequence of tasks that must finish on time.</div></div>
            <div class="def-card"><div class="d-term">Total Float</div><div class="d-desc">Time an activity can be delayed without delaying the overall project.</div></div>
            <div class="def-card"><div class="d-term">Mass Customisation</div><div class="d-desc">Using flexible computer-aided technology to produce custom items at mass production costs.</div></div>
            <div class="def-card"><div class="d-term">Offshoring</div><div class="d-desc">Relocating a business process from one country to another.</div></div>
            <div class="def-card"><div class="d-term">Reshoring</div><div class="d-desc">Moving a previously offshored operation back to its original country.</div></div>
            <div class="def-card"><div class="d-term">ERP</div><div class="d-desc">Enterprise Resource Planning: Software to manage resources and improve efficiency.</div></div>
            <div class="def-card"><div class="d-term">Benchmarking</div><div class="d-desc">Comparing business performance against the best companies in the industry.</div></div>
        </div>
    </div>

</div>

        <div id="view-scorecard" class="hidden">
            <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:20px;">
                <div>
                    <h2 style="font-size:2rem; color:var(--text-dark);">Performance Analytics</h2>
                    <p style="color:#888;">Track your progress across all exam series</p>
                </div>
                <button class="reset-icon-btn" onclick="resetAll()">‚ö† WIPE DATA</button>
            </div>
            <div id="stats-overview" class="stats-container"></div>
            <div id="score-table-container"></div>
        </div>

        <div id="view-workspace" class="hidden">
            <button class="nav-btn" onclick="backToDash()" style="margin-bottom:10px;">‚Üê Back to Papers</button>
            <div class="toggle-insert" onclick="toggleInsert()">üìñ Toggle PDF Case Study</div>
            <div class="workspace">
                <div class="insert-panel" id="insert-panel">
                    <iframe id="insert-pdf" class="insert-pdf-frame" src=""></iframe>
                </div>
                <div class="questions-panel" id="questions-container"></div>
            </div>
        </div>

    </div>
</div>

<script>
    const paperData = {
        /* 2025 SERIES */
        '2025_on_31': { title: "Pedro's Perfect Pies (PPP)", pdf: "9609_w25_in_31.pdf", questions: [ { n:'1', m:8, t:'Analyse two likely impacts on PPP of the changing external influences.', l:'150-225'}, { n:'2', m:8, t:'Analyse two benefits to PPP of using quality assurance.', l:'150-225'}, { n:'3(a)', m:2, t:'Using Table 1.3, calculate the payback period for PPP\'s new machine.'}, { n:'3(b)', m:2, t:'Using Table 1.3, calculate the ARR for PPP\'s new machine.'}, { n:'3(c)', m:12, t:'Evaluate whether PPP should invest in the new machine.', l:'250-350'}, { n:'4(a)', m:4, t:'Calculate the monthly revenue from the sales of the classic pie after the price increase.'}, { n:'4(b)', m:12, t:'Evaluate the usefulness to PPP of elasticity measures.', l:'250-350'}, { n:'5', m:12, t:'Evaluate the importance of emotional intelligence to Pedro\'s leadership.', l:'250-350'} ] },
        '2025_on_32': { title: "Komate Tropical Juice (KTJ)", pdf: "9609_w25_in_32.pdf", questions: [ { n:'1', m:8, t:'Analyse one advantage and one disadvantage to KTJ of delegation.', l:'150-225'}, { n:'2', m:8, t:'Analyse two impacts on KTJ of its commitment to CSR.', l:'150-225'}, { n:'3(a)', m:2, t:'Calculate the payback period of the country C location.'}, { n:'3(b)', m:2, t:'Calculate the ARR of the country D location.'}, { n:'3(c)', m:12, t:'Evaluate which location KTJ should choose for its new factory.', l:'250-350'}, { n:'4(a)', m:4, t:'Calculate the four period centred moving average for Quarter 1 2025.'}, { n:'4(b)', m:12, t:'Evaluate the usefulness of time series analysis to KTJ.', l:'250-350'}, { n:'5', m:12, t:'Evaluate the likely impact on KTJ of fluctuations in the exchange rate.', l:'250-350'} ] },
        '2025_on_33': { title: "Lithium Battery Metals (LBM)", pdf: "9609_w25_in_33.pdf", questions: [ { n:'1', m:8, t:'Analyse two advantages to the government of country G from nationalisation.', l:'150-225'}, { n:'2', m:8, t:'Analyse one benefit and one limitation of sales forecasting to LBM.', l:'150-225'}, { n:'3(a)', m:2, t:'Using Table 1.1, calculate the payback period.'}, { n:'3(b)', m:2, t:'Using Table 1.1, calculate the NPV over six years discounted at 8%.'}, { n:'3(c)', m:12, t:'Evaluate LBM\'s decision to go ahead with the hot water mine.', l:'250-350'}, { n:'4(a)', m:4, t:'Calculate total float for activity C and minimum project duration.'}, { n:'4(b)', m:12, t:'Evaluate the importance of CPA to the success of the hard rock mine.', l:'250-350'}, { n:'5', m:12, t:'Evaluate LBM\'s decision to use two different approaches to HRM.', l:'250-350'} ] },
        '2025_mj_31': { title: "Wisdom Shoes (WS)", pdf: "9609_s25_in_31.pdf", questions: [ { n:'1', m:8, t:'Analyse two advantages to WS of using an environmental audit.', l:'150-225'}, { n:'2', m:8, t:'Analyse two benefits to WS of Enterprise Resource Planning (ERP).', l:'150-225'}, { n:'3(a)', m:2, t:'Refer to Table 1.4. Calculate the change in dividend yield.'}, { n:'3(b)', m:2, t:'Refer to Table 1.4. Calculate the change in P/E ratio.'}, { n:'3(c)', m:12, t:'Evaluate the likely impact on WS shareholders of the proposed changes.', l:'250-350'}, { n:'4(a)', m:4, t:'Calculate the inventory turnover ratio.'}, { n:'4(b)', m:12, t:'Evaluate the usefulness of ratio analysis to WS directors.', l:'250-350'}, { n:'5', m:12, t:'Evaluate the importance of environmental targets to WS success.', l:'250-350'} ] },
        '2025_mj_32': { title: "Pura AI Robots (PAIR)", pdf: "9609_s25_in_32.pdf", questions: [ { n:'1', m:8, t:'Analyse two benefits to PAIR of contingency planning.', l:'150-225'}, { n:'2', m:8, t:'Analyse two benefits to PAIR of its organisational structure.', l:'150-225'}, { n:'3(a)', m:2, t:'Calculate the labour productivity for 2025.'}, { n:'3(b)', m:2, t:'Calculate the labour turnover.'}, { n:'3(c)', m:12, t:'Evaluate the likely impact on PAIR of the decision to change from quality control to quality assurance.', l:'250-350'}, { n:'4(a)', m:4, t:'Calculate the total float for the critical path.'}, { n:'4(b)', m:12, t:'Evaluate the usefulness of Critical Path Analysis (CPA) to PAIR.', l:'250-350'}, { n:'5', m:12, t:'Evaluate the extent to which PAIRs future success depends on external influences.', l:'250-350'} ] },
        '2025_mj_33': { title: "We Care Products (WCP)", pdf: "9609_s25_in_33.pdf", questions: [ { n:'1', m:8, t:'Analyse two ways the external influences referred to in lines 8-12 may impact on WCP.', l:'150-225'}, { n:'2', m:8, t:'Analyse two benefits to WCP of its social objectives.', l:'150-225'}, { n:'3(a)', m:2, t:'Calculate the labour turnover rate at GC.'}, { n:'3(b)', m:2, t:'Calculate the cost per unit.'}, { n:'3(c)', m:12, t:'Evaluate whether Aldin should change the HRM approach at GC.', l:'250-350'}, { n:'4(a)', m:4, t:'Calculate the marketing budget variance.'}, { n:'4(b)', m:12, t:'Evaluate the effectiveness of WCP‚Äôs marketing strategy.', l:'250-350'}, { n:'5', m:12, t:'Evaluate the likely impact on WCP of the takeover of GC.', l:'250-350'} ] },
        '2025_fm_32': { title: "Iyipada (IPA)", pdf: "9609_m25_in_32.pdf", questions: [ { n:'1', m:8, t:'Analyse one advantage and one disadvantage to IPA of changing employment contracts.', l:'150-225'}, { n:'2', m:8, t:'Analyse two methods to improve IPA\'s liquidity.', l:'150-225'}, { n:'3(a)', m:2, t:'Calculate, for 2024, IPA\'s market share.'}, { n:'3(b)', m:2, t:'Calculate, for 2025, the expected percentage market growth.'}, { n:'3(c)', m:12, t:'Evaluate the Marketing Director\'s proposed changes to IPA\'s marketing mix.', l:'250-350'}, { n:'4(a)', m:2, t:'Complete nodes 5 and 6 on the network diagram.'}, { n:'4(b)', m:2, t:'Calculate the total float for Activity F.'}, { n:'4(c)', m:12, t:'Evaluate the benefit to IPA of Critical Path Analysis (CPA).', l:'250-350'}, { n:'5', m:12, t:'Evaluate the most likely impact on IPA of the fiscal and monetary policy changes.', l:'250-350'} ] },

        /* 2024 SERIES */
        '2024_on_31': { title: "TopoChoc Enterprises (TC)", pdf: "9609_w24_in_31.pdf", questions: [ { n:'1', m:8, t:'Analyse two benefits to TC of marketing planning for the new range of chocolate bars.', l:'150-225'}, { n:'2', m:8, t:'Analyse two advantages to TC of setting SMART business objectives.', l:'150-225'}, { n:'3(a)', m:2, t:'Calculate the current ratio for 2023.'}, { n:'3(b)', m:2, t:'Calculate the acid test ratio for 2023.'}, { n:'3(c)', m:12, t:'Evaluate whether the directors should worry about TCs liquidity.', l:'250-350'}, { n:'4(a)', m:4, t:'Calculate the contribution of one chocolate bar.'}, { n:'4(b)', m:12, t:'Evaluate the proposal to produce chocolate bars.', l:'250-350'}, { n:'5', m:12, t:'Evaluate the importance of Total Quality Management (TQM) to TC.', l:'250-350'} ] },
        '2024_on_32': { title: "Habesha Clean Cooking (HCC)", pdf: "9609_w24_in_32.pdf", questions: [ { n:'1', m:8, t:'Analyse two impacts on HCC of the increase in competition in country E.', l:'150-225'}, { n:'2', m:8, t:'Analyse two advantages to HCC of being a social enterprise.', l:'150-225'}, { n:'3(a)', m:2, t:'Calculate the capacity utilisation for the Wonder Stove in 2023.'}, { n:'3(b)', m:2, t:'Calculate the increase in profit if production is outsourced.'}, { n:'3(c)', m:12, t:'Evaluate the decision to outsource production of the Wonder Stove.', l:'250-350'}, { n:'4(a)', m:4, t:'Calculate the EST and LFT for activity F.'}, { n:'4(b)', m:12, t:'Evaluate the usefulness of Critical Path Analysis (CPA) to HCC.', l:'250-350'}, { n:'5', m:12, t:'Evaluate the importance of business planning to the success of HCCs expansion into country K.', l:'250-350'} ] },
        '2024_on_33': { title: "Australasia Fitness Factory (AFF)", pdf: "9609_w24_in_33.pdf", questions: [ { n:'1', m:8, t:'Analyse two threats to AFF from changes in its external environment.', l:'150-225'}, { n:'2', m:8, t:'Analyse one advantage and one disadvantage to AFF of being a public limited company.', l:'150-225'}, { n:'3(a)', m:2, t:'Calculate the return on capital employed (ROCE) for 2023.'}, { n:'3(b)', m:2, t:'Calculate the gearing ratio for 2023.'}, { n:'3(c)', m:12, t:'Evaluate the likely impact on AFF shareholders of the new share issue.', l:'250-350'}, { n:'4(a)', m:4, t:'Calculate the dividend yield for 2022.'}, { n:'4(b)', m:12, t:'Evaluate the usefulness of ratio analysis to AFFs directors.', l:'250-350'}, { n:'5', m:12, t:'Evaluate whether TQM is the best way to solve customer complaint problems.', l:'250-350'} ] },
        '2024_mj_31': { title: "Gordy Building Supplies (GBS)", pdf: "9609_s24_in_31.pdf", questions: [ { n:'1', m:8, t:'Analyse two advantages to GBS of using flexible part-time employment contracts.', l:'150-225'}, { n:'2', m:8, t:'Analyse two disadvantages to GBS of its proposed communication process innovation.', l:'150-225'}, { n:'3(a)', m:2, t:'Calculate the gearing ratio.'}, { n:'3(b)', m:2, t:'Calculate the return on capital employed (ROCE).'}, { n:'3(c)', m:12, t:'Evaluate the usefulness of ratio analysis to GBS‚Äôs directors.', l:'250-350'}, { n:'4(a)', m:4, t:'Calculate the total float for activity C.'}, { n:'4(b)', m:12, t:'Evaluate the usefulness of Critical Path Analysis (CPA) to GBS.', l:'250-350'}, { n:'5', m:12, t:'Evaluate the extent to which corporate social responsibility (CSR) should influence GBS‚Äôs decision to expand into new land.', l:'250-350'} ] },
        
        /* CORRECTED PAPER (Based on 9609_s24_qp_32.pdf) */
        '2024_mj_32': { title: "Soymai Farms (SF)", pdf: "9609_s24_in_32.pdf", questions: [ { n:'1', m:8, t:'Analyse two advantages to SF of using flexible employment contracts.', l:'150-225'}, { n:'2', m:8, t:'Analyse two problems SF may experience when implementing total quality management (TQM).', l:'150-225'}, { n:'3(a)', m:1, t:'Refer to Table 1.1. Calculate for quarter 1, 2023, the seasonal variation.'}, { n:'3(b)', m:3, t:'Refer to Table 1.1. Calculate for quarter 2, 2023, the centred quarterly moving average.'}, { n:'3(c)', m:12, t:'Evaluate the usefulness to SF of sales forecasting.', l:'250-350'}, { n:'4(a)', m:4, t:'Refer to Table 1.2. Calculate the accounting rate of return (ARR) of automating production.'}, { n:'4(b)', m:12, t:'Evaluate whether SF should invest in automating production.', l:'250-350'}, { n:'5', m:12, t:'Evaluate the impact on SF of country B becoming a member of the NFTA international trading agreement.', l:'250-350'} ] },
        
        '2024_mj_33': { title: "Sunil's Clothing Company (SCC)", pdf: "9609_s24_in_33.pdf", questions: [ { n:'1', m:8, t:'Analyse two impacts on SCC of the changing external influences in country Z.', l:'150-225'}, { n:'2', m:8, t:'Analyse two disadvantages to SCC of the proposed new factory.', l:'150-225'}, { n:'3(a)', m:2, t:'Calculate the Accounting Rate of Return (ARR) for the new factory.'}, { n:'3(b)', m:2, t:'Calculate the Payback Period.'}, { n:'3(c)', m:12, t:'Evaluate whether SCC should proceed with the new factory investment.', l:'250-350'}, { n:'4(a)', m:4, t:'Calculate the total float for activity B.'}, { n:'4(b)', m:12, t:'Evaluate the importance of Critical Path Analysis (CPA) to the success of the new factory.', l:'250-350'}, { n:'5', m:12, t:'Evaluate whether Sunil should use a soft or hard approach to human resource management.', l:'250-350'} ] },
        
        /* CORRECTED PAPER (Based on 9609_m24_qp_32.pdf) */
        '2024_fm_32': { title: "Clean Delivery (CD)", pdf: "9609_m24_in_32.pdf", questions: [ { n:'1', m:8, t:'Analyse two benefits to CD resulting from internal economies of scale.', l:'150-225'}, { n:'2', m:8, t:'Analyse two advantages to CD of changing to a geographical organisational structure.', l:'150-225'}, { n:'3(a)', m:1, t:'Refer to Table 1.1. For 2024, calculate the price earnings ratio.'}, { n:'3(b)', m:3, t:'Refer to Table 1.1. For 2024, calculate the return on capital employed (ROCE).'}, { n:'3(c)', m:12, t:'Evaluate the usefulness of the data in Table 1.1 to potential shareholders when considering whether to buy shares in CD.', l:'250-350'}, { n:'4(a)', m:4, t:'Refer to lines 36-40. Calculate the estimated change in quantity demanded if CD increases the price of its detergent from $4.00 to $4.60.'}, { n:'4(b)', m:12, t:'Evaluate the importance of new product development to CD\'s future success.', l:'250-350'}, { n:'5', m:12, t:'Evaluate the impact on CD of the appreciation of country K\'s exchange rate.', l:'250-350'} ] }
    };

    function getUser() { return localStorage.getItem('user'); }
    function setUser(u) { localStorage.setItem('user', u); }
    function getAttempts(u) { return JSON.parse(localStorage.getItem(`attempts_${u}`) || '{}'); }

    function saveAttempt(u, pid, qn, data) {
        const atts = getAttempts(u);
        if(!atts[pid]) atts[pid] = {};
        atts[pid][qn] = data;
        localStorage.setItem(`attempts_${u}`, JSON.stringify(atts));
    }

    function tryLogin() {
        const u = document.getElementById('u-in').value.trim();
        const p = document.getElementById('p-in').value.trim();
        if(p === '011406' && u.includes('.') && u.split('.').length >= 2) {
            setUser(u);
            const name = u.split('.')[0];
            const cleanName = name.charAt(0).toUpperCase() + name.slice(1);
            document.getElementById('welcome-msg').innerText = `Welcome, ${cleanName}`;
            document.getElementById('login-layer').classList.add('hidden');
            document.getElementById('app-layer').classList.remove('hidden');
            setView('papers');
        } else { alert("Incorrect Credentials."); }
    }

    function doLogout() { localStorage.removeItem('user'); location.reload(); }

   function setView(viewName) {
    // Added 'definitions' and 'chat' to this list
    ['papers', 'scorecard', 'workspace', 'formulae', 'definitions', 'chat'].forEach(v => {
        const el = document.getElementById(`view-${v}`);
        if(el) el.classList.add('hidden');
    });
    
    document.getElementById(`view-${viewName}`).classList.remove('hidden');
    
    // Update active button state
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
        if(btn.innerText.toLowerCase().includes(viewName) || (viewName === 'chat' && btn.innerText.includes('AI'))) btn.classList.add('active');
    });

    if(viewName === 'scorecard') renderScorecard();
}

    function backToDash() { setView('papers'); }
    function toggleInsert() { document.getElementById('insert-panel').classList.toggle('show'); }

    // 1. New Word Counter Function
    function countWords(textarea, displayId) {
        const text = textarea.value.trim();
        const count = text ? text.split(/\s+/).length : 0;
        document.getElementById(displayId).innerText = `${count} Words`;
        
        // Optional: Visual cue if text is too short
        const display = document.getElementById(displayId);
        if(count < 50) display.style.color = '#e11d48'; // Red if too short
        else display.style.color = 'var(--lime-dark)';   // Green if good
    }

    // 2. Updated openPaper (Includes Word Count & Clean Model Answer)
    function openPaper(pid) {
        const data = paperData[pid];
        const u = getUser();
        const attempts = getAttempts(u)[pid] || {};
        
        document.getElementById('insert-pdf').src = data.pdf;
        
        let qHtml = `<h2 style="margin-bottom:20px; color:var(--lime-dark);">${data.title}</h2>`;
        
        data.questions.forEach(q => {
            const att = attempts[q.n] || {};
            const done = att.score !== undefined;
            
            let aoHtml = '';
            if(done) {
                aoHtml = `<div style="display:flex; gap:10px; flex-wrap:wrap; margin:15px 0;">
                    <span class="score-badge" style="background:#fff; font-size:0.8rem;">AO1: ${att.ao1 || '-'}</span>
                    <span class="score-badge" style="background:#fff; font-size:0.8rem;">AO2: ${att.ao2 || '-'}</span>
                    <span class="score-badge" style="background:#fff; font-size:0.8rem;">AO3: ${att.ao3 || '-'}</span>
                    <span class="score-badge" style="background:#fff; font-size:0.8rem;">AO4: ${att.ao4 || '-'}</span>
                </div>`;
            }

            // Calculate initial word count
            const initCount = att.answer ? att.answer.trim().split(/\s+/).length : 0;

            qHtml += `<div class="question-card">
                <div class="q-header"><strong>Q${q.n}</strong><span class="q-badge">${q.m} Marks</span></div>
                <p style="font-weight:600; margin-bottom:10px;">${q.t}</p>
                
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                    ${q.l ? `<span style="font-size:0.85rem; color:#888;">Target: ${q.l} words</span>` : '<span></span>'}
                    <span id="wc_${pid}_${q.n}" class="word-count-display">${initCount} Words</span>
                </div>

                <textarea id="ans_${pid}_${q.n}" 
                          oninput="countWords(this, 'wc_${pid}_${q.n}')" 
                          placeholder="Type your answer here...">${att.answer || ''}</textarea>
                
                <button class="submit-btn ${done ? 'completed' : ''}" onclick="submitAnswer('${pid}', '${q.n}')">${done ? '‚úì Re-Evaluate' : 'Submit'}</button>
                
                ${done ? `<div class="feedback-box">
                            <h3 style="margin-bottom:10px;">Score: ${att.score}/${q.m}</h3>
                            ${aoHtml}
                            <p><strong>Strengths:</strong> ${att.strengths}</p>
                            <p><strong>Improvements:</strong> ${att.weaknesses}</p>
                            <div class="model-answer-box"><strong>Model Answer:</strong><br><br>${att.modelAnswer}</div>
                          </div>` : ''}
            </div>`;
        });
        
        document.getElementById('questions-container').innerHTML = qHtml;
        setView('workspace');
    }

  async function submitAnswer(pid, qn) {
    const el = document.getElementById(`ans_${pid}_${qn}`);
    const btn = event.target;
    const ans = el.value.trim();
    if(!ans) return alert("Please write an answer first.");
    
    btn.innerText = "‚è≥ Strict Marking..."; 
    btn.disabled = true;

    // 1. GET QUESTION DATA
    const qData = paperData[pid].questions.find(q => q.n === qn);
    
    // 2. GENERATE STRICT RUBRIC BASED ON MARKS
    // ... (Your strict marking logic is handled in Python now, so we just send marks)

    try {
        const res = await fetch('[https://ultimate-exam-guide.onrender.com/mark](https://ultimate-exam-guide.onrender.com/mark)', {
            method: 'POST', 
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ 
                question: qData.t,
                case_study: `Refer to ${paperData[pid].title} PDF context.`, // Or send full text if you extracted it
                answer: ans, 
                marks: qData.m 
            })
        });
        
        const json = await res.json();
        
        saveAttempt(getUser(), pid, qn, { 
            answer: ans, 
            score: json.score, 
            ao1: json.ao1, 
            ao2: json.ao2, 
            ao3: json.ao3, 
            ao4: json.ao4, 
            strengths: json.strengths, 
            weaknesses: json.weaknesses, 
            modelAnswer: json.model_answer 
        });
        
        openPaper(pid); // Refresh view to show feedback
        
    } catch(e) { 
        console.error(e);
        alert("Error: Server not responding. Try again."); 
        btn.innerText = "Retry"; 
        btn.disabled = false; 
    }
}


    function renderScorecard() {
        const u = getUser();
        const allAtts = getAttempts(u);
        let totalQ = 0, totalAns = 0, totalScore = 0, possibleScore = 0, papersStarted = 0;
        let rows = '';

        Object.keys(paperData).forEach(pid => {
            const pAtts = allAtts[pid] || {};
            const qs = paperData[pid].questions;
            const answeredCount = Object.keys(pAtts).length;
            if(answeredCount > 0) papersStarted++;
            
            let pScore = 0, pMax = 0;
            qs.forEach(q => {
                pMax += q.m;
                if(pAtts[q.n]) {
                    pScore += (pAtts[q.n].score || 0);
                    totalScore += (pAtts[q.n].score || 0);
                    possibleScore += q.m;
                }
            });
            totalQ += qs.length;
            totalAns += answeredCount;
            
            const percent = (answeredCount / qs.length) * 100;
            
            rows += `<tr>
                <td><div style="font-weight:700;">${paperData[pid].title}</div><div style="font-size:0.8rem; color:#888;">${pid}</div></td>
                <td><div class="progress-track"><div class="progress-fill" style="width:${percent}%"></div></div> <span style="font-size:0.9rem; font-weight:600;">${answeredCount}/${qs.length}</span></td>
                <td><span class="score-badge">${pScore}/${pMax}</span></td>
                <td>${answeredCount > 0 ? `<button class="reset-icon-btn" onclick="resetPaper('${pid}')">Reset</button>` : '-'}</td>
            </tr>`;
        });

        const accuracy = possibleScore > 0 ? Math.round((totalScore/possibleScore)*100) : 0;
        
        document.getElementById('stats-overview').innerHTML = `
            <div class="stat-card"><span class="stat-value">${papersStarted}</span><span class="stat-label">Papers Started</span></div>
            <div class="stat-card"><span class="stat-value">${totalAns}</span><span class="stat-label">Questions Solved</span></div>
            <div class="stat-card"><span class="stat-value">${accuracy}%</span><span class="stat-label">Global Accuracy</span></div>
        `;
        
        document.getElementById('score-table-container').innerHTML = `<table class="modern-table"><thead><tr><th>Paper</th><th>Progress</th><th>Score</th><th>Action</th></tr></thead><tbody>${rows}</tbody></table>`;
    }

    function resetPaper(pid) {
        if(confirm("Delete all answers for this paper?")) {
            const u = getUser();
            const atts = getAttempts(u);
            delete atts[pid];
            localStorage.setItem(`attempts_${u}`, JSON.stringify(atts));
            renderScorecard();
        }
    }
    function resetAll() {
        if(confirm("WIPE ALL DATA?")) { localStorage.clear(); location.reload(); }
    }

    /* === NEW CHAT FUNCTIONS === */
    function handleChatEnter(e) { if(e.key === 'Enter') sendChatMessage(); }

    async function sendChatMessage() {
        const input = document.getElementById('chat-input');
        const msg = input.value.trim();
        if(!msg) return;

        // 1. Add User Message
        const chatWin = document.getElementById('chat-messages');
        chatWin.innerHTML += `<div class="chat-msg user-msg">${msg}</div>`;
        input.value = '';
        chatWin.scrollTop = chatWin.scrollHeight;

        // 2. Show Typing Indicator (Optional but nice)
        const loadingId = 'loading-' + Date.now();
        chatWin.innerHTML += `<div id="${loadingId}" class="chat-msg ai-msg" style="color:#888;">Typing...</div>`;
        chatWin.scrollTop = chatWin.scrollHeight;

        try {
            const res = await fetch('[https://ultimate-exam-guide.onrender.com/chat](https://ultimate-exam-guide.onrender.com/chat)', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ message: msg })
            });
            const json = await res.json();
            
            // 3. Replace Typing with AI Answer
            document.getElementById(loadingId).remove();
            
            // Format bold text from Markdown (**text**) to HTML (<b>text</b>)
            const formattedReply = json.reply.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            
            chatWin.innerHTML += `<div class="chat-msg ai-msg">${formattedReply}</div>`;
            chatWin.scrollTop = chatWin.scrollHeight;

        } catch(e) {
            document.getElementById(loadingId).innerText = "Error: Could not connect to AI Tutor.";
        }
    }

    if(getUser()) { 
        const u = getUser();
        const name = u.split('.')[0];
        const cleanName = name.charAt(0).toUpperCase() + name.slice(1);
        document.getElementById('welcome-msg').innerText = `Welcome, ${cleanName}`;
        document.getElementById('login-layer').classList.add('hidden'); 
        document.getElementById('app-layer').classList.remove('hidden'); 
        setView('papers'); 
    }
</script>
</body>
</html>